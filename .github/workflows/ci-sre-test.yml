#Create an image from the Dockerfile provided in the GitHub repo 
#and push it to asia.gcr.io

name: Push to GCR GitHub Action

on: [push]

jobs:

  build-and-push-to-gcr:
    runs-on: ubuntu-latest
    steps:      

      - uses: actions/checkout@v3

      - name: Push dummy-pdf-or-png image to asia.gcr
        uses: RafikFarhad/push-to-gcr-github-action@v5-beta
        with:
          gcloud_service_key: ${{ secrets.GCLOUD_SERVICE_KEY }} 
          registry: asia.gcr.io
          project_id: ${{ secrets.GCLOUD_PROJECT_ID }}
          image_name: dummy-pdf-or-png
          image_tag: latest
          dockerfile: ./Dockerfile
          context: ./sre/dummy-pdf-or-png

      - name: Push getfile-app image to asia.gcr
        uses: RafikFarhad/push-to-gcr-github-action@v5-beta
        with:
          gcloud_service_key: ${{ secrets.GCLOUD_SERVICE_KEY }} 
          registry: asia.gcr.io
          project_id: ${{ secrets.GCLOUD_PROJECT_ID }}
          image_name: getfile-app
          image_tag: latest
          dockerfile: ./Dockerfile
          context: ./sre/getfile-app
